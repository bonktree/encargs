_rule_ = $(outdir)/all/@rule

# This has to be first so it is the default target.
all: $(outdir)/encargs

test: | $(outdir)/encargs
	@$(outdir)/test/@

install: | $(outdir)/encargs
	@$(outdir)/install/@

check: | $(outdir)/encargs
	@$(outdir)/check/@

$(outdir)/encargs: $(outdir)/encargs.c.o $(outdir)/base64.c.o $(outdir)/util.c.o
	@$(_rule_)CCLD $@ '' $(CC) -o $@ $^ $(CFLAGS) $(LDFLAGS)

$(outdir)/encargs.c.o: $(outdir)/encargs-config.h

-include $(outdir)/encargs.c.o.d $(outdir)/base64.c.o.d $(outdir)/util.c.o.d

$(outdir)/%.c.o: $(srcdir)/%.c
	@$(_rule_)CC $@ $< $(CC) -o $@ -c $< -MMD -MQ $@ -MF $@.d -std=c11 $(CFLAGS) $(CPPFLAGS) -I. -I$(srcdir)

.PHONY: install test check
