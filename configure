#!/bin/sh -euf

srcdir="$(realpath "$(dirname $0)")"
outdir="$(realpath out)"

. "$srcdir"/undertools-lib.sh

prefix="/usr/local"

conf_cli_options "$@"

CC="${CC-cc}"
CFLAGS="${CFLAGS-}"
CPPFLAGS='-D_GNU_SOURCE'

produce_rule_trace CC 'Compiling C object $target'
produce_rule CCLD 'Linking C executable $target'
produce_buildgraph
produce_test
produce_install

generate_file 'encargs-config.h' \
	'#define %s %s\n' PROJECT_NAME '"encargs"' PROJECT_VERSION '"0.1"'

grep -E '^([a-z]*dir|[a-z]*prefix)' "$outdir/install/@"
grep -E '^([A-Z]*FLAGS)' "$outdir/Makefile"
